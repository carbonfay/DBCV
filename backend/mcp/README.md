# MCP DBCV Server

–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ DBCV —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Responses API.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **MCP Server** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
- **DBCV API Client** - –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DBCV Backend API
- **Tools** - –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤:
  - `BotTools` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
  - `StepTools` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞–º–∏
  - `RequestTools` - —Å–æ–∑–¥–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
  - `ConnectionTools` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **Autonomous Assistant** - –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å Responses API

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞:
1. **–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–≥–æ–≤** - –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏ –±–æ—Ç–∞
2. **–°–æ–∑–¥–∞–Ω–∏–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤** - –≤–Ω–µ—à–Ω–∏–µ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** - —Å–≤—è–∑–∏ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd backend/mcp
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
export OPENAI_API_KEY="your-openai-api-key"
export MCP_AUTH_TOKEN="your-auth-token"
export DBCV_BACKEND_URL="http://localhost:8003"
export MCP_HOST="localhost"
export MCP_PORT="8005"
export LOG_LEVEL="INFO"
```

### 3. –ó–∞–ø—É—Å–∫ MCP —Å–µ—Ä–≤–µ—Ä–∞

#### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä (stdio):
```bash
python run_server.py
```

#### HTTP MCP —Å–µ—Ä–≤–µ—Ä (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):
```bash
python run_http_server.py
```

### 4. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

#### Production:
```bash
docker-compose up mcp-dbcv
```

#### Development:
```bash
docker-compose -f docker-compose.dev.yml up mcp-dbcv
```

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã MCP

### Bot Tools:
- `get_bot_info` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
- `list_bots` - —Å–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `create_bot` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±–æ—Ç
- `update_bot` - –æ–±–Ω–æ–≤–∏—Ç—å –±–æ—Ç

### Step Tools:
- `create_step` - —Å–æ–∑–¥–∞—Ç—å —à–∞–≥ –±–æ—Ç–∞
- `update_step` - –æ–±–Ω–æ–≤–∏—Ç—å —à–∞–≥
- `get_step_info` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∞–≥–µ
- `delete_step` - —É–¥–∞–ª–∏—Ç—å —à–∞–≥

### Request Tools:
- `create_request` - —Å–æ–∑–¥–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å
- `update_request` - –æ–±–Ω–æ–≤–∏—Ç—å HTTP –∑–∞–ø—Ä–æ—Å
- `get_request_info` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—Ä–æ—Å–µ
- `delete_request` - —É–¥–∞–ª–∏—Ç—å HTTP –∑–∞–ø—Ä–æ—Å

### Connection Tools:
- `create_connection_group` - —Å–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `update_connection_group` - –æ–±–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `get_connection_group_info` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö
- `delete_connection_group` - —É–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –±–æ—Ç–∞-–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è:

1. **–°–æ–∑–¥–∞—Ç—å —à–∞–≥ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è:**
```json
{
  "tool": "create_step",
  "params": {
    "bot_id": "bot_id_here",
    "name": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ",
    "description": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    "message": "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?",
    "timeout": 30,
    "is_proxy": false
  }
}
```

2. **–°–æ–∑–¥–∞—Ç—å master connection:**
```json
{
  "tool": "create_connection_group",
  "params": {
    "bot_id": "bot_id_here",
    "connections": [{
      "next_step_id": "step_id_here",
      "search_type": "message",
      "code": "message.text == 'start'"
    }]
  }
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ —Å HTTP –∑–∞–ø—Ä–æ—Å–æ–º:

1. **–°–æ–∑–¥–∞—Ç—å —à–∞–≥–∏:**
```json
{
  "tool": "create_step",
  "params": {
    "bot_id": "bot_id_here",
    "name": "–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö",
    "description": "–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç API",
    "is_proxy": true
  }
}
```

2. **–°–æ–∑–¥–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å:**
```json
{
  "tool": "create_request",
  "params": {
    "name": "API –∑–∞–ø—Ä–æ—Å",
    "url": "https://api.example.com/data",
    "method": "GET",
    "headers": "{\"Content-Type\": \"application/json\"}"
  }
}
```

3. **–°–æ–∑–¥–∞—Ç—å connection –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "tool": "create_connection_group",
  "params": {
    "request_id": "request_id_here",
    "connections": [{
      "next_step_id": "processing_step_id",
      "search_type": "response",
      "variables": "{\"response.data\": \"session.data\"}"
    }]
  }
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `OPENAI_API_KEY` - API –∫–ª—é—á OpenAI (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `MCP_AUTH_TOKEN` - —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- `DBCV_BACKEND_URL` - URL DBCV Backend API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: http://localhost:8003)
- `MCP_HOST` - —Ö–æ—Å—Ç MCP —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: localhost)
- `MCP_PORT` - –ø–æ—Ä—Ç MCP —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 8005)
- `LOG_LEVEL` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: INFO)

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

MCP —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**:
- JWT —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ `/autonomous-assistant/generate` endpoint
- –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ–ª—å `DEVELOPER` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
- –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Responses API –≤ MCP —Å–µ—Ä–≤–µ—Ä

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏:
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ:
- –°–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –í—ã–∑–æ–≤–∞—Ö API
- –û—à–∏–±–∫–∞—Ö –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:
```bash
curl http://localhost:8003/api/v1/health
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [MCP Specification](https://modelcontextprotocol.io/)
- [OpenAI Responses API](https://platform.openai.com/docs/guides/responses)
- [DBCV API Documentation](../app/api/routes/)
